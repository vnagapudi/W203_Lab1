---
title: "Lab 1 - EDA for Cancer Dataset"
author: "Thomas Drage, Venkatesh Nagapudi"
date: "September 22, 2018"
output: 
  pdf_document: 
    fig_height: 4
    fig_width: 5.5
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(tidy=TRUE)
```

W203 Statistics for Data Science, Fall 2018.

##1.  Introduction
This is an exploratory data analysis to examine the relationship between patient death rates due to by cancer and various demographic factors including the type of insurance coverage, income level, race etc. 

These relationships will be addressed using a dataset provided by the Government Health Agency and consists of survey data taken at county level for selected areas in the United States utilising 2015 as the current population and cancer mortality data averaged across the years 2009-2013. The basis for the selection of these areas is unknown. The intent of this analysis is to assist the Government Health Agency in identifying communities which could benefit from social intervention to reduce cancer mortality rates and to identify which particular areas of intervention would be of most benefit. Note that this report does not seek to create a statistical model for the data provided but to provide insight into the key features and relationships associated with this problem.

This analysis is structured as follows:

1. Introduction

2. Univariate Analysis of Key Variables

3. Analysis of Key Relationships

4. Analysis of Secondary Effects

5. Conclusion

###Setup

This analysis is presented using the R language, utilising the following packages:
```{r}
library(car)
```

The dataset was provided in CSV format and imported for this analysis:
```{r load}
cancer_data = read.csv("cancer.csv")
```

### Data Selection

A high level summary of cancer_data shows 3047 observations of 30 variables. The important dependent variable is the deathRate. A close second is the incidence rate of cancer, which is the "avgAnnCount". 
Important indepdent variables include poverty levels of the county ("povertyPercent"), how many of them have Private or Public coverage ("PctPrivateCoverage", "PctPublicCoverage"), what is the predominant race and so on. (need to add more)
```{r}
(list_of_varibles = objects(cancer_data))
```

The datatypes can be examined and it can be noted that some level of inference is required with respect to units of measure. The data is largely numeric, with the exception of two Factor types, binnedInc which appears to be an income range for the county and Geography which is simple the state and county name.

```{r}
str(cancer_data)
```

### Data Cleansing

####a) avgAnnCount

The first variable in the dataset is the incidence rate of cancer "avgAnnCount". The outcome variable, deathRate is intuitively dependent on the incidence rate of cancer. Summarizing this variable:
```{r}
summary(cancer_data$avgAnnCount)
```
If we examine the Median and Mean, the Mean is nearly 3.5 times the median. This looks a little suspicious since we can generally expect the data distribution to be normal in nature. Here is a plot of the avgAnnCount
```{r}
plot(cancer_data$avgAnnCount)
```

There is at least one major outlier around the index "1000" and several more at 2400 and 2800. It makes sense to examine avgAnnCount in more detail to see if there are any discrepancies that might be causing these outliers.

From inspection of the dataset, it is clear that the avgAnnCount has some invalid data. It appears that the value "1962.667684" is repeated in several rows. We will need to discard these rows since it is unclear if the rest of the columns contain valid data. So we filter these rows out below

```{r}
cancer_data_filter1 = cancer_data[cancer_data$avgAnnCount != 1962.667684, ]
str(cancer_data_filter1)
```
Now we are down to 2841 observations. 

####b) "Age" related data issues

It is safe to assume that the variable should be less than 110. If the age is greater than 110, it is likely that the data itself is invalid. We will take a look at whether Age is greater than 110 now.

```{r}
sum(cancer_data_filter1$MedianAge > 110)
sum(cancer_data_filter1$MedianAgeFemale > 110)
sum(cancer_data_filter1$MedianAgeMale > 110)
```

Clearly some of these rows could be invalid for MedianAge > 110, and it might be best to filter them out.

####c) Some issues related to average household size
We found that there are a few more invalid data items related to average household size. Clearly this has to be at least equal to or greater than 1. But we found 57 of the rows had an average household size < 0.1. We decided that these rows were untrustworthy and we filtered them out.

```{r}
sum(cancer_data_filter1$AvgHouseholdSize < 0.1)
```


```{r}
cancer_data_fixed = cancer_data_filter1[cancer_data_filter1$MedianAge < 110 & cancer_data_filter1$AvgHouseholdSize >=1, ]
str(cancer_data_fixed)
```

Now we are down to 2755 observerations.

####c) Potential problems with Private and Public Coverage not adding up to 100%
PctPrivateCoverage and PctPublicCoverage don't sum to 100% in the majority of cases. This implies that people are covered both with private and public coverage or some don't have coverage at all. 

The sum of both groups ranges from 65 to 131 which is not unreasonable and while this is likely not a problem, we do want to point out this that there could be a possible discrepancy, especially if the incidence of having both forms of coverage was expected to be low.

```{r}
min(cancer_data$PctPublicCoverage + cancer_data$PctPrivateCoverage)
max(cancer_data$PctPublicCoverage + cancer_data$PctPrivateCoverage)
```

####d) Problem with incomplete race related information
The same problem exists with the race related information. It doesn't sum to 100% for many counties, however it is always less than 100, and so it appears some people elected not to state their race. Mostly Alaskan counties form the outliers - the predominant race is likely not captured by this survey.

```{r}
head(cancer_data$PctAsian + cancer_data$PctBlack + cancer_data$PctWhite + cancer_data$PctOtherRace, 25)
min(cancer_data$PctAsian + cancer_data$PctBlack + cancer_data$PctWhite + cancer_data$PctOtherRace)
max(cancer_data$PctAsian + cancer_data$PctBlack + cancer_data$PctWhite + cancer_data$PctOtherRace)
```

####e) Source of marriage data not clear

The dataset gives family information in two formats, PercentMarried and PctMarriedHouseholds. Whilst the exact definitions are not available, we can assume that the the former refers to invididuals and the latter counted if a married couple exists withint he household. Notwithstanding factors such as multiple occupancy and separations we would expect these to be highly correlated. The summaries below support a reasonable range and distribution for this data as-is.

```{r}
summary(cancer_data$PercentMarried)
summary(cancer_data$PctMarriedHouseholds)
```

####f) Education data non-hierarchical and categorisation mixed

Education demographic data is given in a series of columns, categorised by education level and age of respondant. This appears to be raw (but aggregated) survey data. The available columns are:

* PctNoHS18_24: High school not completed, ages 18-24.
* PctHS18_24: High school completed, ages 18-24.
* PctHS25_Over: High school completed, over 25.
* PctSomeCol18_24: Some college completed, ages 18-24.
* PctBachDeg18_24: Bachelor's degree obtained, ages 18-24.
* PctBachDeg25_Over: Bachelor's degree obtained, over 25.

* PctEmployed16_Over: Employment rate, over 16.
* PctUnemployed16_Over: Unemployment rate, over 16.

Note that due to these definitions it is difficult to verify completeness as there are groups we have no information for, e.g. high school not completed for over 25s or those with some college over 25. It should be noted that the strict definitions do not represent vocational education or higher degrees either. We can verify the distribution is reasonable however;

```{r}
summary(cancer_data$PctNoHS18_24)
summary(cancer_data$PctHS18_24)
summary(cancer_data$PctHS25_Over)
summary(cancer_data$PctSomeCol18_24)
summary(cancer_data$PctBachDeg18_24)
summary(cancer_data$PctBachDeg25_Over)
```

The significant number of NA records for PctSomeCol18_24 renders this field unusable for analysis. The zero minimums for PctHS18_24 and PctBackDeg18_24 are also questionable, the single record showing no high school graduates should be excluded from individual analysis however the 118 counties with no respondants without a degree are problematic and will need to be considered when drawing conclusions from this type of data.

```{r}
sum(cancer_data$PctHS18_24 < 0.01)
sum(cancer_data$PctBachDeg18_24 < 0.01)
```

The categorisation of unemployment data also leaves something to be desired as the rest of the population either unable to work or retired is not represented, however on a basic level the data seems reasonable.

```{r}
summary(cancer_data$PctEmployed16_Over)
summary(cancer_data$PctUnemployed16_Over)
```

##2. Univariate Analysis of Key Variables

###a) Establishing an incidence rate using avgAnnCount

The "avgAnnCount" variable is not insightful as given, as it needs to be averaged over the population of the county. For comparison purposes, it needs to have the same defintion of the key outcome variable, deathRate. 

If we look at the above summary, for the first row, BirthRate is 6.12, while deathRate is 165. The avgAnnCount is 1397. 

In order to get the definition of the units of measure for each of these variables, as they were not provided in the dataset we have utilised and verified against the typical ways of representing these measures:

BirthRate is the number of births per 1000 people (1),
DeathRate is the number of deaths per 100,000 people (2),
avgAnnCount is the raw number of cancer incidents in the county.

To prepare avgAnnCount, we have used the same definition as deathRate and come up with a variable "incidenceRate"
```{r}
incidenceRate = 100000*cancer_data_fixed$avgAnnCount/cancer_data_fixed$popEst2015
summary(incidenceRate)
```

The mean and median values are very close indicating a symmetric distribution, which can be verified in a histogram:

```{r}
hist(incidenceRate, main = "Incidence Rate of Cancer", xlab = "Incidence Rate per 100,000 people")
```

The standard deviation of this quantity is: 

```{r}
sd(incidenceRate)
```
Which shows a significant variation in incidence on a geographical basis, foreshadowing some demographic dependence on cancer incidence in the US.

###b) Analyzing the key outcome variable: deathRate

Now looking at the key outcome variable deathRate and summarizing it:
```{r}
summary(cancer_data_fixed$deathRate)
```
The Median and Mean are very close indicating a symmetric distribution. Plotting this variable in a histogram:
```{r}
hist(cancer_data_fixed$deathRate, main = "Death Rate due to cancer", xlab = "Death rate per 100,000 people")
```

This shows that on an average 180 people die of cancer while 550 people are diagnosed with cancer for every 100,000 people. This means that nearly 1/3rd of all people who are diagnosed with cancer die within six years of diagnosis. 

The standard deviation is:

```{r}
sd(cancer_data_fixed$deathRate)
```
This is slightly narrower on a percentage basis (16% vs 22%) than the cancer incidence rate and the relationship between these two quantities is worthy of further analysis in Section 3. 

(Note: The study indicates that the deathRates are from 2015 while the incidence rates are between 2009 and 2013.) 

###c) Analyzing birthRate

For completeness, the birthRate is analysed here, though it seems very unlikely that this will influence the deathRate due to cancer. Summarizing the birthRate:
```{r}
summary(cancer_data_fixed$BirthRate)
```
The mean and median are similar, though the maximum seems to be very high. Plotting the data with a histogram:
```{r}
hist(cancer_data_fixed$BirthRate, main = "Birth Rate Distribution", breaks = 0:22 - 0.5, xlab = "Birth Rate in for 1000 people")
```
Birth rates over 12 seem to be very low in terms of frequency. 

The average birth rate of approximately 5.0 is is questionable since the average birth rate in the USA is around 12.2 per 1,000 people. It is unclear why these counties have a low birth rate that is more than 60% lower than national average. Perhaps there is a certain type of cancer that causes lower birth rates? This anomaly would benefit from further investigation.

###d) Analyzing how patients are covered by Private and Public Coverage

As mentioned earlier, it seems as if some patients have both Public and Private Coverage, or some have neither. On average however, slightly more than 60% of people have public insurance and slightly less than 40% have private insurance and the degree of variation between counties is not particularly large. Some counties have significant variation, potentially related to emplyoment or economic factors.

```{r}
boxplot(cancer_data_fixed$PctPublicCoverage, cancer_data_fixed$PctPrivateCoverage, main = "Public and Private Insurance Coverage Distribution", names = c("Private","Public"), ylab = "Percent")
```
Analyzing Private Coverage further, it is clear that most private coverage is employer provided.
```{r}
hist(cancer_data_fixed$PctEmpPrivCoverage / cancer_data_fixed$PctPrivateCoverage,
     main = "Percentage of Employer Provided Private Coverage", 
     xlab = "Percentage Employer provided Private coverage")
```

###e) Analyzing Race related information

Further analysis of the race-related information shows that it is definitely incomplete, for example, we can examine the distribution of races and the distribution of the sum of the given categories;

```{r}
boxplot(cancer_data$PctWhite, cancer_data$PctBlack, cancer_data$PctAsian, cancer_data$PctOtherRace, names = c("White", "Black", "Asian", "Other"))

hist(cancer_data$PctWhite + cancer_data$PctBlack + cancer_data$PctAsian + cancer_data$PctOtherRace)
```

There is definitely a predominance of Whites in the population as expected, but the inconsistency points to a preference not to specify race in the survey. As it is well known that genetic predispositions to diseases linked to race exist this is problematic for our analysis as some minorities are certainly under-represented. 

###f) Analyzing and preparing Income related variables

Let's analyze medIncome and binnedInc. medIncome is the median income of the county is a good indicator on the poverty percent. Binned Income is the income separated out into 10 bins. 

Summarizing the two variables, here is what we see
```{r}
summary(cancer_data_fixed$medIncome)
summary(cancer_data_fixed$binnedInc)
```

The binned income has a problem as the last level is not ordered. We will need to put the last bin first. So we can prepare the data as follows:
```{r}
cancer_data_fixed$binnedInc = factor(cancer_data_fixed$binnedInc, c("[22640, 34218.1]","(34218.1, 37413.8]","(37413.8, 40362.7]","(40362.7, 42724.4]","(42724.4, 45201]","(45201, 48021.6]","(48021.6, 51046.4]","(51046.4, 54545.6]","(54545.6, 61494.5]","(61494.5, 125635]"))
```


##3. Analysis of Key Relationships

###a) Relationship between incidence rate and death rate
We now examine how the key outcome variable deathRate is related to other variables. First, let's see if there is a correlation between the incidence rate and death rates. Intuitively, it seems to make sense that the higher the incidence rate, the higher the death rate should be, however we noted a variation in the distributions previously.  

```{r}
plot(incidenceRate, cancer_data_fixed$deathRate)
```

There is a general trend that higher death rate due to cancer occurs where there is a higher incidence rate, but the significant variability observed indicates that there are other effects at play which are independent of the two events. For example, environmental or race-prevalance effects may influence cancer incidence but health insurance or poverty effects may have a greater role in death due to variability of treatment outcomes. We can quantify this with the correlation coefficient:

```{r}
cor(incidenceRate, cancer_data_fixed$deathRate)
```

This indicates a positive correlation, however it is not particularly strong.

###b) Relationship between death rate and median income

One of the key relationships we want to examine is whether a county with a lower income generally sees a higher deathRate since it is likely that battling cancer is an expensive proposition. First we examine the correlation:
```{r}
cor(cancer_data_fixed$deathRate, cancer_data_fixed$medIncome)
```
There is a negative correlation confirming that the deathRate is indeed higher if the median income is lower. 

Let's now figure the correlation between deathRate and median income bins using a boxplot.

```{r}
boxplot(deathRate ~ binnedInc, data = cancer_data_fixed, 
        main = "Death rate vs Median Income bins",
        xlab = "Median Income bins",
        ylab = "Death Rate")
```
As can be clearly seen, the higher the income, the lower is the death rate. This indicates that if the county is very poor on an average, then it is likely to have a higher death rate. We test this hypothesis by comparing deathRate against povertyPercent. 

Revisting (a) above, we can note the correlation with incidenceRate:

```{r}
cor(incidenceRate, cancer_data_fixed$medIncome)
```
This is a lesser correlation and highlights that a larger variety of factors are at play in causing incidences of cancer than in treatment outcomes.

###c) Relationship between death rate and poverty percentage

```{r}
cor(cancer_data_fixed$povertyPercent, cancer_data_fixed$deathRate)
```
We notice that the correlation to povertyPercent is almost identical in absolute value to the median income (medIncome). 
Let's examine the correlation between medIncome and povertyPercent now:
```{r}
cor(cancer_data_fixed$medIncome, cancer_data_fixed$povertyPercent)
```
There is a very strong negative correlation nearly close to -1.0 as expected between medIncome and povertyPercent. This similarity suggests only that they both indicate economic influence on cancer death rate.

###d) Relationship between death rate and private & public coverage

Now let's examine the coverage options that the people in the county are able to choose from.

Clearly the affordability of healthcare is a major consideration is the battle against cancer. It is likely that if a person has a higher salary, he will choose to go with Private Health care which is intuitively better than Public Health care. Let's look at the correlation between these two variables.

```{r}
cor(cancer_data_fixed$deathRate, cancer_data_fixed$PctPrivateCoverage)
```
This does show the strong negative correlation confirming that deathRates are inversely related to Private Coverage. Let's plot this out and make sure.

```{r}
plot (~ jitter(PctPrivateCoverage,2) + jitter(deathRate,2), data = cancer_data_fixed)
abline(lm(cancer_data_fixed$deathRate ~ cancer_data_fixed$PctPrivateCoverage))
```


We now examine the relationship between deathRate and Public coverage.
```{r}
cor(cancer_data_fixed$deathRate, cancer_data_fixed$PctPublicCoverage)
```
There is a very strong positive correlation indicating that death rates in counties that have higher Public Coverage are much higher. There is a problem if the county relies on public health coverage. 

We could plot this out similar to the one for Private coverage.

```{r}
plot (~ jitter(PctPublicCoverage,2) + jitter(deathRate,2), data = cancer_data_fixed)
abline(lm(cancer_data_fixed$deathRate ~ cancer_data_fixed$PctPublicCoverage))
```

###e) Importance of age on incidence rate and death rate

Does cancer affect older people much more than younger ones? This might be important so that we can understand whether younger people need to have some sort of coverage so that they don't succumb to cancer.

For this, let's examine incidenceRate of cancer against age.

```{r}
cor(incidenceRate, cancer_data_fixed$MedianAge)
```
There is a very large correlation between incidence rate and median age. It seems that higher the age, the greater there is chance of getting cancer. Let's examine if the deathRates due to cancer are related to MedianAge in any way.

```{r}
cor(cancer_data_fixed$deathRate, cancer_data_fixed$MedianAge)
```

There is almost no correlation between the two variables! Clearly, while a higher age results in a higher likelihood of cancer, age itself is not a factor when it comes to the deathRate. Clearly, once cancer sets in, the death rate itself depends on factors such as coverage and median income.

But it might make sense to examine whether age affects the likelihood of getting private coverage. Perhaps if it is easy for the younger people to get private coverage, that might explain why MedianAge does not correlate well with deathRate. Plotting the two variables out:

```{r}
plot(~ cancer_data_fixed$MedianAge+cancer_data_fixed$PctPrivateCoverage, 
     xlab = "Age", 
     ylab = "Pct Private Coverage" )
abline(lm(cancer_data_fixed$PctPrivateCoverage ~ cancer_data_fixed$MedianAge), 
       xlab = "Age", 
       ylab = "Pct Private Coverage")
```

Clearly, there is almost a flat line above, indicating that age is not a factor in getting private coverage. Perhaps the younger people get covered by their parents and this is one reason for the non-correlation.


##4. Analysis of Secondary Effects

###a) The importance of race on incidence rate and death rate

One of the interesting points to understand is whether a certain demographic is poorer than others, and if so, whether that is causing a significant impact to the deathRate. This could result in actionable insights for certain organizations (say charities) that are focused on a particular race. For this purpose, we can examine the correlation between PovertyPercent and the race.
```{r}
cor(cancer_data_fixed$povertyPercent, cancer_data_fixed$PctBlack)
cor(cancer_data_fixed$povertyPercent, cancer_data_fixed$PctWhite)
cor(cancer_data_fixed$povertyPercent, cancer_data_fixed$PctAsian)
cor(cancer_data_fixed$povertyPercent, cancer_data_fixed$PctOtherRace)
```
The results are interesting. Blacks seem to be the poorest of all the races. Let's check whether they are also the most vulnerable to cancer deaths.

```{r}
cor(cancer_data_fixed$deathRate, cancer_data_fixed$PctBlack)
cor(cancer_data_fixed$deathRate, cancer_data_fixed$PctWhite)
cor(cancer_data_fixed$deathRate, cancer_data_fixed$PctAsian)
cor(cancer_data_fixed$deathRate, cancer_data_fixed$PctOtherRace)
```
This is indeed so. An important result here is that the government could focus on improving the conditions of Black people and by doing that, cancer death rates could fall.

But to be safe, let's also look at whether incidence rate is related to race

```{r}
cor(incidenceRate, cancer_data_fixed$PctBlack)
cor(incidenceRate, cancer_data_fixed$PctWhite)
cor(incidenceRate, cancer_data_fixed$PctAsian)
cor(incidenceRate, cancer_data_fixed$PctOtherRace)
```

This is a very interesting insight. Whites seem to be more prone to cancer than blacks, yet as we can see, the death rates are higher in Blacks than Whites. This clearly shows that the Blacks seem to be at a disadvantage due to their poverty level.


###b)How do people choose between public and private coverage

Just so that we understand people's choices a bit more, do they choose private coverage if they are above the poverty level? And do they choose to go with public coverage otherwise? We can examine this using some plots
```{r}
scatterplotMatrix(~ cancer_data_fixed$povertyPercent + cancer_data_fixed$PctPrivateCoverage + cancer_data_fixed$PctPublicCoverage)
```
Clearly, people who are below the poverty line seem to go with public coverage. In general, this means that if median incomes go up, then people would buy private insurance and survive cancer. 

###c) Effect of education on median incomes
It seems intuitive that better education would leave to higher median incomes, and that would in turn result in private coverage, and reduced death rates. 

Let's examine this correlation. We can choose a couple of related variables - people with Bachelors degree and people with just HighSchool and observe the correlation to Death rate.
```{r}
cor(cancer_data_fixed$deathRate, cancer_data_fixed$PctBachDeg25_Over)
cor(cancer_data_fixed$deathRate, cancer_data_fixed$PctHS25_Over)
```
The results seem intuitive. If you have higher education, you likely don't succumb to cancer. Higher education should be tied to employment, and employment will result in private coverage. Let's examine the relationship between employment and education to be sure this is the case.
```{r}
cor(cancer_data_fixed$PctEmployed16_Over, cancer_data_fixed$PctBachDeg25_Over, use = "complete.obs")
cor(cancer_data_fixed$PctEmployed16_Over, cancer_data_fixed$PctHS25_Over, use = "complete.obs")
```
In this case, we had to use "complete.obs" since there were some invalid observations. As we can clearly see, having a bachelor's degree seems to be very critical to being employed.

###d) Does being married help with reduction of deathRates?

What one can intuit is that married people might have better coverage than unmarried ones, and that could lead to reduced deathRates. Let's examine this relationship. First off, what is the correlation between marriage and coverage?

```{r}
cor(cancer_data_fixed$PctMarriedHouseholds, cancer_data_fixed$PctPrivateCoverage)
cor(cancer_data_fixed$PctMarriedHouseholds, cancer_data_fixed$PctPublicCoverage)
```
The data seems to make sense. It is likely that the median income is higher in the case of married families. Let's see if that is the case with a boxplot

```{r}
boxplot(PctMarriedHouseholds ~ binnedInc, data = cancer_data_fixed, 
        main = "Married Households vs Median Income bins",
        xlab = "Median Income bins",
        ylab = "Married Households")
```
Clearly, being married helps since the median income is higher and results in better treatment.

So that we complete this picture, if we compare deathRates against MarriedHouseholds, there should be a negative correlation. Let's check:
```{r}
cor(cancer_data_fixed$deathRate, cancer_data_fixed$PctMarriedHouseholds)
```

It is indeed so. DeathRates are lower when patients are married, as seen above, due to higher median incomes.

###d) Does size of household have a bearing on deathRates?
Let's examine the size of households now.
```{r}
summary(cancer_data_fixed$AvgHouseholdSize)
```


It looks like there are anywhere from 1.86 through 4 people per household. This is now correct after we discarded a number of very low values which did not make sense.

Let's plot deathRate against the number of people in a boxplot to see the correlation.

```{r}
HouseholdSize_bin = cut(cancer_data_fixed$AvgHouseholdSize, breaks = c(1, 2, 3, 4, Inf))
boxplot( deathRate ~ HouseholdSize_bin , data = cancer_data_fixed,
        main = "Death rate vs Average Household size",
        xlab = "Average Household Size",
        ylab = "Death Rate")
```

The higher the household size, the lesser the deathRate. This is likely because the median income is higher in the case of the bigger households. Let's check if this is the case.

```{r}
boxplot(AvgHouseholdSize ~ binnedInc, data = cancer_data_fixed, 
        main = "Average household size vs Median Income bins",
        xlab = "Median Income bins",
        ylab = "Average household size")
```

There is an increase in median income as the average household size increases, but only slightly so.


##5. Conclusion