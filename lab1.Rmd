---
title: "Lab 1 - EDA for Cancer Dataset"
author: "Nikita Nadkarni, Thomas Drage, Venkatesh Nagapudi"
date: "September 14, 2018"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

W203 Statistics for Data Science, Fall 2018.

##1.  Introduction
This is an exploratory data analysis to examine the relationship between patient death rates caused by cancer versus various factors including the type of patient coverage, patient income levels and so on.
The data analysis includes the following sections:
1. Preliminary Dataset analysis
2. Problems with the Dataset
3. Conclusions that can be reasonably achieved
4. Recommendations 
5. Improvements to the Dataset


First include library for scatterplots
```{r}
library(car)
```


```{r load}
cancer_data = read.csv("cancer.csv")
```

### List of variables in cancer data


```{r}
(list_of_varibles = objects(cancer_data))
```
A high level summary of cancer_data shows 3047 observations of 30 variables. The important dependent variable is the deathRate. A close second is the incidence rate of cancer, which is the "avgAnnCount". 
Important indepdent variables include poverty levels of the county ("povertyPercent"), how many of them have Private or Public coverage ("PctPrivateCoverage", "PctPublicCoverage"), what is the predominant race and so on. (need to add more)

```{r}
str(cancer_data)
```


a) How do we determine whether the deaths were caused because the cancer was undiagnosed? Or whether it was diagnosed and not cured because it was incurable? Or whether it was diagnosed and not cured because the patient couldn't afford it? Since everything is averaged out per county, there is no way of knowing. Perhaps in my mind, the biggest issue with this dataset is that it provides the summary data per geography, rather than the individual patient data itself. What we need is per patient data, not the summary data...perhaps we need to bring this up as the major problem. Thoughts?

Birthrate ~ births*1000 / est population

Deathrate (due to cancer) ~ deaths*100 000 / est population

b) PctPrivateCoverage and PctPublicCoverage don't add up to 100%. So some people are covered both with private and public coverage or some don't have coverage at all. The numbers range from 65 to 131 when you add them up. 
```{r}
head(cancer_data$PctPublicCoverage + cancer_data$PctPrivateCoverage, 25)
min(cancer_data$PctPublicCoverage + cancer_data$PctPrivateCoverage)
max(cancer_data$PctPublicCoverage + cancer_data$PctPrivateCoverage)
```

c) The same problem exists with the race related information. It doesn't add up to 100%. 

```{r}
head(cancer_data$PctAsian + cancer_data$PctBlack + cancer_data$PctWhite + cancer_data$PctOtherRace, 25)
min(cancer_data$PctAsian + cancer_data$PctBlack + cancer_data$PctWhite + cancer_data$PctOtherRace)
max(cancer_data$PctAsian + cancer_data$PctBlack + cancer_data$PctWhite + cancer_data$PctOtherRace)
```

##2. Univariate Analysis of Key Variables

The first variable in the spreadsheet "cancer.csv" is the incidence rate of cancer "avgAnnCount". The outcome variable, deathRate is intuitively dependent on the incidence rate of cancer. Summarzing this variable:
```{r}
summary(cancer_data$avgAnnCount)
```
If we examine the Median and Mean, the Mean is nearly 3.5 times the median. This looks a little suspicious since we can generally expect the data distribution to be normal in nature. Here is a plot of the avgAnnCount
```{r}
plot(cancer_data$avgAnnCount)
```
There is at least one major outlier around the index "1000" and a couple of more at 2400 and 2800. It makes sense to examine what is going on with the avgAnnCount to see if there are any discrepancies that might be causing these outliers.

Examining "cancer.csv", it clear that the avgAnnCount has some invalid data. It appears that the value "1962.667684" is repeated in several rows. We will need to discard these rows since it is unclear if the rest of the columns contain valid data. So we filter these rows out below

```{r}
cancer_data_fixed = cancer_data[cancer_data$avgAnnCount != 1962.667684, ]
str(cancer_data_fixed)
```
Now we are down to 2841 observations. 

The "avgAnnCount" variable is not very useful since it needs to be averaged over the population of the county. To be useful, it needs to have the same defintion of the key outcome variable, deathRate. 

If we look at the above summary, for the first row, BirthRate is 6.12, while deathRate is 165. The avgAnnCount is 1397. 

In order to get the definition of each of these variables, since there is not enough data in the spreadsheet, we used the defintions offered on the internet.

BirthRate is the number of births per 1000 people^^1
DeathRate is the number of deaths per 100,000 people^^2
avgAnnCount is just the number of cancer incidents in the county.

To prepare avgAnnCount, we decided to use the same definition as deathRate and come up with a variable "incidenceRate"
```{r}
incidenceRate = 100000*cancer_data_fixed$avgAnnCount/cancer_data_fixed$popEst2015
summary(incidenceRate)
```
The mean and median values are very close indicating a normal distribution. Plotting the histogram now:

```{r}
hist(incidenceRate, main = "Incidence Rate of Cancer", xlab = "Incidence Rate per 100,000 people")
```

Now looking at the key outcome variable deathRate and summarizing it:
```{r}
summary(cancer_data_fixed$deathRate)
```
The Median and Mean are very close indicating Normal distribution. Plotting this variable in a histogram:
```{r}
hist(cancer_data_fixed$deathRate, main = "Death Rate due to cancer", xlab = "Death rate per 100,000 people")
```

This shows that on an average 180 people die of cancer while 550 people are diagnosed with cancer for every 100,000 people. This  means that nearly 1/3rd of all people who are diagnosed with cancer die within six years of diagnosis. (The study indicates that the deathRates are from 2015 while the incidence rates are between 2009 and 2013) 

Let's now look at the birthRate for completeness though it seems very unlikely that this will influence the deathRate due to cancer. Summarizing the birthRate
```{r}
summary(cancer_data_fixed$BirthRate)
```
The Mean and Median are pretty close, though the Max seems to be very high. Plotting the data with a histogram:
```{r}
hist(cancer_data_fixed$BirthRate, main = "Birth Rate Distribution", breaks = 0:22 - 0.5, xlab = "Birth Rate in for 1000 people")
```
Birth rates over 12 seem to be very low in terms of frequency. 

The average birth rate being around 5.0 is a bit suspicious. The average birth rate in the USA is around 12.2 per 1,000 people. It is unclear why these counties have a low birth rate that is more than 60% lower than national average. Perhaps there is a certain type of cancer that causes lower birth rates? Perhaps this needs a bit more investigation.

##3. Analysis of Key Relationships


d) deathRate doesn't take into account the population of the county. Perhaps this is a huge problem. Maybe the data is not so bad if you find the actual % of population that died because of cancer and correlate it against other variables? A lot of the data so far that I gathered might be wrong if the main variable is not meaningful. Thoughts?

```{r}
#added new column into cancer_data
cancer_data$pctDeathRate = cancer_data$deathRate/cancer_data$popEst2015
```
Also, how do we know that the deathRate data is for 2015?

Let's see how pctDeathRate vs PcctPrivateCoverage looks now
```{r}
plot (~ jitter(cancer_data$PctPrivateCoverage,2) + jitter(cancer_data$pctDeathRate,2), type = "h")
```
How about the correlation between the two variables?
```{r}
cor(cancer_data$pctDeathRate, cancer_data$PctPrivateCoverage)
```
This shows very little correlation. (Nikita/Thomas - thoughts??)
How about the correlation between pctDeathRates and PublicCoverage?
```{r}
cor(cancer_data$pctDeathRate, cancer_data$PctPublicCoverage)
```
This seems somewhat intuitive. Perhaps with public coverage, treatment is bad.

How about median income?

```{r}
cor(cancer_data$pctDeathRate, cancer_data$medIncome)
```
A negative correlation that is as strong as the public coverage. Perhaps makes sense.

And how about poverty level

```{r}
cor(cancer_data$pctDeathRate, cancer_data$povertyPercent)
```
Not as correlated...what does this mean? That deathrates are not dependent so much on poverty?


How is death_rate correlated to the important variables? This ScatterPlotMatrix might throw some light
```{r}
scatterplotMatrix(~ deathRate + povertyPercent + medIncome + PctPrivateCoverage + PctPublicCoverage, data = cancer_data)
```
A few preliminary observations show that deathRate is positively correlated to povertyPercent and PctPublicCoverage, while it is negatively correlated to medIncome and PctPrivateCoverage. This can be verified with the correlations below:
```{r}
#correlation of deathRate to important variables
cor(cancer_data$deathRate, cancer_data$povertyPercent)
cor(cancer_data$deathRate, cancer_data$medIncome)
cor(cancer_data$deathRate, cancer_data$PctPrivateCoverage)
cor(cancer_data$deathRate, cancer_data$PctPublicCoverage)
```

There seems to be a high degree of correlation between income and deathRate. Is it possible that the deathRates are high because the cancer can be suppressable through treatment and the poorer people cannot afford it? Or is it because the cancer is incurable? We are not sure that this distinction can be reasonably figured out. But let's say that the cancer is curable - then there should be a correlation between deathRate and income. Let's see:
```{r}
plot (~ cancer_data$medIncome + cancer_data$deathRate, type = "h")
```
There seems to be a gradual drop in death rates for people with higher median incomes. However, there are definitely some outliers as we see a lot of spikes in the death rates in some cases. Are these related to incurable cancers? Are these related to the geography in some ways? How do we figure out?

Redoing some analysis here (Venky: Sep 15, 8:15pm PST) using actual numbers instead of percentages since deathRate is really not a %.

What is the correlation between deathRate and number of people with private coverage?
```{r}
NumPeopleWithPrivCoverage = cancer_data$PctPrivateCoverage * cancer_data$popEst2015
cor(cancer_data$deathRate, NumPeopleWithPrivCoverage)
```
Here is a plot 
```{r}
plot(~ jitter(log(NumPeopleWithPrivCoverage),2) + jitter(cancer_data$deathRate,2), type = "h")
```



What is the correlation between deathRate and number of people with public coverage?
```{r}
NumPeopleWithPublicCoverage = cancer_data$PctPublicCoverage * cancer_data$popEst2015
cor(cancer_data$deathRate, NumPeopleWithPublicCoverage)
```


##4. Analysis of Secondary Effects

##5. Conclusion